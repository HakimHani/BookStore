<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Admin DashBoard</title>
	<link th:href="@{/css/login.css}" rel="stylesheet" />
  	<link rel="preconnect" href="https://fonts.gstatic.com">
  	<link href="https://fonts.googleapis.com/css2?family=Nerko+One&display=swap" rel="stylesheet">
  	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  	<script type="text/javascript" th:src="@{/js/login.js}"></script>
	<link href="css/admin.css" rel="stylesheet" />
</head>
<body>


	<div id="topper" class="container">
	    <div class="navbar">
	      <div class="logo">
	        <a href="/index"><img th:src="@{/img/bookstore.png}" width="125px"></a>
	      </div>
	      <nav>
	        <ul>
	          <li><a href="/index">Home</a></li>
	          <li><a href="/products">Books</a></li>
	          <li><a href="#">About</a></li>
	          <li><a href="#">Contact</a></li>
	          <li><a href="/login">Sign in/ Register</a></li>
	        </ul>
	      </nav>
	      <a href="/cart"><img th:src="@{/img/cart.png}" width="25px" height="25px"></a>
	    </div>
 	</div>

	<center><h3>All Products</h3></center>
	<button type="button" onclick="doAdminsAjax('/api/iteminfo/', 'populate_products_handler');">show products</button>
    <div align = "center" id="products_table" class="products" style="border:'1'; cellpadding:'5';"></div>
    <br/><br/><br/>
    <div id="EditProduct" style="display:none">
    	<fieldset><legend class = "legend">Edit product</legend>
          
              <table>
                 <tbody>
                   <tr style = "background: white;">
                     <td><label for = "productId">Id:</label></td><td><input id = "productId" name = "productId" style = "font-size:16px;"
                                value = '' type = "text" readonly/></td>
                   </tr>
                   <tr style="background: white;">
                     <td><label for = "product">Product:</label></td><td><input id = "product" name = "product" style = "font-size:16px;"
										value = "" type = "text"/></td>
                   </tr>
                   <tr style="background: white;">
                     <td><label for = "category">Category:</label></td><td><input id = "category" name = "category" style = "font-size:16px;"
                                value = "" type = "text"/></td>
                   </tr>
		   		   <tr style = "background: white;">
                     <td><label for = "price">Price:</label></td><td><input id = "price" name = "price" style = "font-size:16px;"
                                value = "" type = "number" step = "0.01" min = "0"/></td>
                   </tr>
                   
                   <tr style = "background: white;">
                     <td><label for = "inventory">Inventory:</label></td><td><input id = "inventory" name = "inventory" style = "font-size:16px;"
                                value = "" type = "number" step = "1" min = "0"/></td>
                   </tr>
                   
                   <tr style = "background: white;">
                     <td><label for = "available">Availabe:</label></td><td><input id = "available" name = "available" style = "font-size:16px;"
                                value = "" type = "number" min="0" max="1"/></td>
                   </tr>
                   
                 </tbody>
              </table>
              <p><button type="button" onclick="saveEdits();">Save Edits</button></p>
              <p><a href="">Back</a></p>
          
        </fieldset>
    </div>
    
    <!------freatured product------->
  <div class="footer">
    <div class="container">
      <div class="row">
        <div class="footer-col-1">
          <h3>Search</h3>
          <p>Need anybooks quickly? search and get the best books at bookstore & Accessories</p><br />
          <input type="text" placeholder="Search.." name="search">
          <button type="submit"><i class="fa fa-search"></i></button>
        </div>
        <div class="footer-col-2">
          <img th:src="@{/img/bookstore.png}">
          <p>Search more books and get exclusive offers.The best books and more.</p>
        </div>
        <div class="footer-col-3">
          <h3>Contact us</h3>
          <ul>
            <li>Help</li>
            <li>Contact us</li>
            <li>Feedback</li>
            <li>Privacy notice</li>
          </ul>
        </div>
        <div class="footer-col-4">
          <h3>Follow us</h3>
          <ul>
            <li>Facebook</li>
            <li>Twitter</li>
            <li>Instagram</li>
            <li>Youtube</li>
          </ul>
        </div>
      </div>
      <hr>
      <p class="copyright">
        <i class="fa fa-copyright" aria-hidden="true"></i>
        Copyright 2020 - EECS4413 Group member: Yuanfen Gu, Yikun Peng, Abdulhkem klif
      </p>
    </div>
  </div>

</body>
</html>

<script>

// generate a report with the books sold each month
var domain = "http://localhost:8090";

function doAjax(address){
	 var request = new XMLHttpRequest();
	 var month = document.getElementById("monthlyReport").value;
	 var url = "./api/checkout/" + month;
	 request.onreadystatechange = function() {
			handler(request);
	 };
	 request.open("GET", url, true);
	 request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
	 request.send(); 
} 

function handler(request){
	 if ((request.readyState == 4) && (request.status == 200))
	 {
		 var target = document.getElementById("result");
		 target.innerHTML = request.responseText;
	 }
}

//provide real time analytics (Listeners) with most popular products (life time), like â€œtop 10 sold books
function getBooksStats(){
	var request = new XMLHttpRequest();
	url = "./api/"
	request.onreadystatechange = function(){
		handlerBooksStats(request);
	 };
	 request.open("GEt", ulr, true);
	 request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
	 request.send(data); 	
}

function handlerBooksStats(request){
	 if ((request.readyState == 4) && (request.status == 200))
	 {
		 var target = document.getElementById("result");
		 var result =  JSON.parse(request.responseText);
		 var table = buildTable(result);
		 table.border = '1';
		 target.innerHTML = "";
		 target.appendChild(table);
	 }
}

function buildTable(result){
	var table = document.createElement("TABLE");
	table.setAttribute("id", "myTable");
 var row = document.createElement("TR");
 var data = document.createElement("TD");
 data.innerHTML = "Book Title";
 row.appendChild(data);
 
 data = document.createElement("TD");
 data.innerHTML = "Book Id";
 row.appendChild(data);
 
 table.appendChild(row);
 
 var i=0;
 for (i=0; i<result.length; i++){
 	
	    row = document.createElement("TR");
	    
	    data = document.createElement("TD");
	    data.innerHTML =result[i].username;
	    row.appendChild(data);
	    
	    data = document.createElement("TD");
	    data.innerHTML = result[i];
	    row.appendChild(data);
	    
	    table.appendChild(row);
 }
 
 return table;
}

// admins ops
function doAdminsAjax(path, handler){
	 var request = new XMLHttpRequest();
	 request.onreadystatechange = function() {
		 if(handler == "populate_products_handler"){
			populate_products_handler(request);
		 } else if(handler == "Edit")
			 Edit(request);
		 
	 };
	 request.open("GET", domain + path, true);
	 request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
	 request.send(); 
} 

function doAdminsAjaxPost(path, handler){
	 var request = new XMLHttpRequest();
	 request.onreadystatechange = function() {
		 if(handler == "populate_products_handler"){
			populate_products_handler(request);
		 } else if(handler == "Edit")
			 Edit(request);
		 else if(handler == "deleted")
			 deleted(request);
		 
	 };
	 request.open("POST", domain + path);
	 //request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
	 request.send(); 
} 

function populate_products_handler(request){
	 if ((request.readyState == 4) && (request.status == 200)) {
		 var target = document.getElementById("products_table");
		 var products = JSON.parse(request.responseText)
		 var table = "";
		 table += '<table class = "products" border = "1">';
		 table += "<tr>";
		 table += "<td>Id</td>";
		 table += "<td>Product</td>";
		 table += "<td>Category</td>";
		 table += "<td>Price</td>";
		 table +="</tr>";
		 
		 for (var product of products) {
			 table += "<tr>";
			 table +="<td class = 'rght'>" + product.productId + "</td>";
			 table +="<td class='cent'>" + product.itemName + "</td>";
			 table +="<td class='cent'>" + product.category + "</td>";
			 table += "<td class='rght'>" + product.price + "</td>";
			 table += '<td><button onclick="showProductDetails(\'' + product.productId + '\' );">' + "Show" + "</a></td>"; 
			 table += '<td><button onclick="editProduct(\'' + product.productId + '\' );">' + "Edit" + "</a></td>"; 
			 table += '<td><button onclick="deleteProduct(\'' + product.productId + '\' );">' + "Delete" + "</a></td>"; 
			 table += "</tr>"
		 }
		 target.innerHTML = table;
	 }
}

function showProductDetails(id){
	console.log(id);
}

function editProduct(id){
	doAdminsAjax('/api/iteminfo/' + id + "", "Edit")
}

function deleteProduct(id){
	doAdminsAjaxPost('/api/iteminfo/delete/'+id , "deleted")
}


function Edit(request){
	if ((request.readyState == 4) && (request.status == 200)){
		var edit = document.getElementById("EditProduct");
		edit.style.display = "block";
		var product = JSON.parse(request.responseText);
		document.getElementById("productId").value = product.productId;
		document.getElementById("product").value = product.itemName;
		document.getElementById("available").value = product.isAvialable;
		document.getElementById("inventory").value = product.inventory;
		document.getElementById("price").value = product.price;
		var category = document.getElementById("category").value = product.category;
	}
}

function deleted(request){
	if ((request.readyState == 4) && (request.status == 200)) {
		location.reload();
	}	
}

function saveEdits(){
	var productId = document.getElementById("productId").value;
	var pname = document.getElementById("product").value;
	var category = document.getElementById("category").value;
	var available = document.getElementById("available").value;
	var inv = document.getElementById("inventory").value;
	var price = document.getElementById("price").value;
	var xhr = new XMLHttpRequest();
    xhr.open("POST", domain + "/api/iteminfo/update_inventory/", true);
    xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
    var data = {
        "productId": productId,
    	"itemName": pname,
    	"isAvaliable": available,
    	"category": category,
    	"inventory": inv,
    	"price": price
    };
    var myJSON = JSON.stringify(data);
    console.log(data);
    xhr.send(myJSON);
    xhr.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            console.log(this.responseText);
            }
    }
}














































</script>

